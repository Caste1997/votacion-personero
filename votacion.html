<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Jornada Democrática 2026</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getDatabase, ref, runTransaction, onValue } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "votaciones-personero-74663.firebaseapp.com",
  databaseURL: "https://votaciones-personero-74663-default-rtdb.firebaseio.com/",
  projectId: "votaciones-personero-74663",
  storageBucket: "votaciones-personero-74663.firebasestorage.app",
  messagingSenderId: "713692900786",
  appId: "1:713692900786:web:81b1e52085f53d984908ab"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let bloqueado = false;
let chart;

window.votar = function(candidato, elemento){

  if(bloqueado) return;

  bloqueado = true;
  document.querySelectorAll("button").forEach(b => b.disabled = true);

  document.querySelectorAll(".card").forEach(c => c.classList.remove("seleccionado"));
  elemento.classList.add("seleccionado");

  const votoRef = ref(db, "votos/" + candidato);
  runTransaction(votoRef, (current)=>{
    return (current || 0) + 1;
  });

  document.getElementById("mensaje").innerHTML =
  "Gracias por participar en la jornada democrática";

  setTimeout(()=>{
    bloqueado = false;
    document.querySelectorAll("button").forEach(b => b.disabled = false);
    document.getElementById("mensaje").innerHTML = "";
    elemento.classList.remove("seleccionado");
  },5000);
}

const votosRef = ref(db,"votos");

onValue(votosRef,(snapshot)=>{
  const data = snapshot.val() || {};
  const c1 = data.candidato1 || 0;
  const c2 = data.candidato2 || 0;
  const blanco = data.blanco || 0;

  if(chart){
    chart.data.datasets[0].data=[c1,c2,blanco];
    chart.update();
  } else{
    const ctx = document.getElementById("miniGrafico");
    chart = new Chart(ctx,{
      type:"bar",
      data:{
        labels:["Candidato 1","Candidato 2","Blanco"],
        datasets:[{
          data:[c1,c2,blanco],
          backgroundColor:["#0B5E20","#15803D","#D4AF37"]
        }]
      },
      options:{
        responsive:true,
        plugins:{legend:{display:false}},
        scales:{
          y:{beginAtZero:true}
        }
      }
    });
  }
});
</script>

<style>
body{
  font-family:Arial;
  background:white;
  margin:0;
  text-align:center;
}

.header{
  background:#0B5E20;
  color:white;
  padding:25px;
}

.contenedor{
  display:flex;
  justify-content:center;
  gap:50px;
  margin-top:40px;
}

.card{
  border:2px solid #D4AF37;
  border-radius:12px;
  padding:20px;
  width:230px;
  transition:0.3s;
}

.card img{
  width:200px;
  height:220px;
  border-radius:10px;
  border:2px solid #D4AF37;
  object-fit:cover;
}

.nombre{
  margin-top:10px;
  font-weight:bold;
  color:#0B5E20;
}

button{
  background:#0B5E20;
  color:white;
  padding:10px 20px;
  border:none;
  border-radius:6px;
  cursor:pointer;
  margin-top:10px;
}

button:disabled{
  background:gray;
}

.seleccionado{
  box-shadow:0 0 20px #D4AF37;
}

#mensaje{
  margin-top:30px;
  font-size:18px;
  color:#0B5E20;
}

.grafico-contenedor{
  width:400px;
  margin:40px auto;
}
</style>
</head>

<body>

<div class="header">
<h1>Jornada Democrática Estudiantil 2026</h1>
<p>Elección de Personero - Escuela Normal Superior Santa María de La Paz</p>
</div>

<div class="contenedor">

<div class="card">
<img src="candidato1.jpg">
<div class="nombre">NOMBRE COMPLETO CANDIDATO 1</div>
<button onclick="votar('candidato1',this.parentElement)">Votar</button>
</div>

<div class="card">
<img src="candidato2.jpg">
<div class="nombre">NOMBRE COMPLETO CANDIDATO 2</div>
<button onclick="votar('candidato2',this.parentElement)">Votar</button>
</div>

<div class="card">
<img src="voto-blanco.jpg">
<div class="nombre">Voto en Blanco</div>
<button onclick="votar('blanco',this.parentElement)">Seleccionar</button>
</div>

</div>

<div id="mensaje"></div>

<div class="grafico-contenedor">
<canvas id="miniGrafico"></canvas>
</div>

</body>
</html>